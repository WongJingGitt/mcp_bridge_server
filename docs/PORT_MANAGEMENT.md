# ç«¯å£ç®¡ç†åŠŸèƒ½

## åŠŸèƒ½æ¦‚è¿°

MCP Bridge Server ç°åœ¨å…·å¤‡æ™ºèƒ½ç«¯å£æ£€æµ‹å’Œç®¡ç†åŠŸèƒ½ï¼Œèƒ½å¤Ÿåœ¨å¯åŠ¨å‰æ£€æŸ¥ç«¯å£å ç”¨æƒ…å†µï¼Œå¹¶æä¾›å¤šç§ä¼˜é›…çš„å¤„ç†æ–¹å¼ã€‚

## å¯åŠ¨æ–¹å¼

### 1. é»˜è®¤å¯åŠ¨ï¼ˆäº¤äº’å¼ï¼‰

```bash
python utils/mcp_bridge.py
```

**è¡Œä¸º**ï¼š
- æ£€æŸ¥é»˜è®¤ç«¯å£ 3849 æ˜¯å¦è¢«å ç”¨
- å¦‚æœè¢«å ç”¨ï¼Œæ˜¾ç¤ºå ç”¨è¿›ç¨‹ä¿¡æ¯å¹¶æä¾›ä¸‰ä¸ªé€‰é¡¹ï¼š
  - `1` - ç»“æŸå ç”¨è¿›ç¨‹å¹¶ç»§ç»­
  - `2` - ä½¿ç”¨å…¶ä»–ç«¯å£
  - `3` - é€€å‡ºç¨‹åº

**ç¤ºä¾‹è¾“å‡º**ï¼š
```
MCP Bridge Server v1.0.0
æ­£åœ¨æ£€æŸ¥ç«¯å£ 3849...

âš ï¸  ç«¯å£ 3849 å·²è¢«å ç”¨
   å ç”¨è¿›ç¨‹: python.exe (PID: 12345)

è¯·é€‰æ‹©æ“ä½œ:
  1. ç»“æŸå ç”¨è¿›ç¨‹å¹¶ç»§ç»­
  2. ä½¿ç”¨å…¶ä»–ç«¯å£
  3. é€€å‡ºç¨‹åº

è¯·è¾“å…¥é€‰é¡¹ (1/2/3): 
```

### 2. è‡ªåŠ¨ç»“æŸå ç”¨è¿›ç¨‹

```bash
# æ–¹å¼ 1: ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°
python utils/mcp_bridge.py --auto-kill-port

# æ–¹å¼ 2: ä½¿ç”¨ç¯å¢ƒå˜é‡
set MCP_AUTO_KILL_PORT=true  # Windows
export MCP_AUTO_KILL_PORT=true  # Linux/Mac
python utils/mcp_bridge.py
```

**è¡Œä¸º**ï¼š
- è‡ªåŠ¨ç»“æŸå ç”¨ç«¯å£çš„è¿›ç¨‹ï¼Œæ— éœ€æ‰‹åŠ¨ç¡®è®¤
- é€‚ç”¨äºè‡ªåŠ¨åŒ–éƒ¨ç½²å’Œ CI/CD ç¯å¢ƒ

### 3. æŒ‡å®šå…¶ä»–ç«¯å£

```bash
python utils/mcp_bridge.py --port 8080
```

**è¡Œä¸º**ï¼š
- ä½¿ç”¨æŒ‡å®šç«¯å£å¯åŠ¨
- å¦‚æœè¯¥ç«¯å£ä¹Ÿè¢«å ç”¨ï¼Œä»ä¼šè§¦å‘ç«¯å£æ£€æµ‹æµç¨‹

### 4. ç»„åˆä½¿ç”¨

```bash
# åœ¨ 8080 ç«¯å£å¯åŠ¨ï¼Œå¦‚æœè¢«å ç”¨åˆ™è‡ªåŠ¨ç»“æŸè¿›ç¨‹
python utils/mcp_bridge.py --port 8080 --auto-kill-port

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶å’Œç«¯å£
python utils/mcp_bridge.py --port 8080 --config /path/to/config.json
```

## å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `--port PORT` | æŒ‡å®šæœåŠ¡å™¨ç«¯å£ | 3849 |
| `--auto-kill-port` | è‡ªåŠ¨ç»“æŸå ç”¨è¿›ç¨‹ | false |
| `--config PATH` | æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ | ç³»ç»Ÿé»˜è®¤è·¯å¾„ |

## ç¯å¢ƒå˜é‡

| å˜é‡å | è¯´æ˜ | å¯é€‰å€¼ |
|--------|------|--------|
| `MCP_AUTO_KILL_PORT` | è‡ªåŠ¨ç»“æŸå ç”¨è¿›ç¨‹ | true, 1, yes |
| `MCP_CONFIG_PATH` | é…ç½®æ–‡ä»¶è·¯å¾„ | æ–‡ä»¶è·¯å¾„ |

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: å¼€å‘ç¯å¢ƒ - æ‰‹åŠ¨æ§åˆ¶

```bash
# äº¤äº’å¼å¯åŠ¨ï¼Œè®©å¼€å‘è€…é€‰æ‹©å¦‚ä½•å¤„ç†ç«¯å£å ç”¨
python utils/mcp_bridge.py
```

é€‚åˆéœ€è¦çµæ´»æ§åˆ¶çš„å¼€å‘ç¯å¢ƒã€‚

### åœºæ™¯ 2: ç”Ÿäº§ç¯å¢ƒ - è‡ªåŠ¨å¤„ç†

```bash
# è‡ªåŠ¨ç»“æŸæ—§è¿›ç¨‹å¹¶å¯åŠ¨æ–°æœåŠ¡
python utils/mcp_bridge.py --auto-kill-port
```

é€‚åˆéœ€è¦å¿«é€Ÿéƒ¨ç½²å’Œæ›´æ–°çš„ç”Ÿäº§ç¯å¢ƒã€‚

### åœºæ™¯ 3: å¤šå®ä¾‹éƒ¨ç½²

```bash
# å®ä¾‹ 1
python utils/mcp_bridge.py --port 3849

# å®ä¾‹ 2
python utils/mcp_bridge.py --port 3850

# å®ä¾‹ 3
python utils/mcp_bridge.py --port 3851
```

åœ¨åŒä¸€å°æœºå™¨ä¸Šè¿è¡Œå¤šä¸ªå®ä¾‹ã€‚

### åœºæ™¯ 4: Docker/å®¹å™¨ç¯å¢ƒ

```dockerfile
# Dockerfile
CMD ["python", "utils/mcp_bridge.py", "--auto-kill-port", "--port", "3849"]
```

æˆ–ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼š

```dockerfile
ENV MCP_AUTO_KILL_PORT=true
CMD ["python", "utils/mcp_bridge.py"]
```

### åœºæ™¯ 5: systemd æœåŠ¡

```ini
[Unit]
Description=MCP Bridge Server
After=network.target

[Service]
Type=simple
User=mcpuser
WorkingDirectory=/opt/mcp-bridge
Environment="MCP_AUTO_KILL_PORT=true"
ExecStart=/usr/bin/python3 utils/mcp_bridge.py
Restart=always

[Install]
WantedBy=multi-user.target
```

## ç«¯å£æ£€æµ‹æœºåˆ¶

### Windows ç³»ç»Ÿ

ä½¿ç”¨ `netstat` å’Œ `tasklist` å‘½ä»¤ï¼š
```bash
netstat -ano | findstr :3849
tasklist /FI "PID eq 12345"
```

ç»“æŸè¿›ç¨‹ï¼š
```bash
taskkill /F /PID 12345
```

### Linux/Mac ç³»ç»Ÿ

ä½¿ç”¨ `lsof` å’Œ `ps` å‘½ä»¤ï¼š
```bash
lsof -i :3849 -t
ps -p 12345 -o comm=
```

ç»“æŸè¿›ç¨‹ï¼š
```bash
kill -9 12345
```

## é”™è¯¯å¤„ç†

### ç«¯å£è¢«å ç”¨ä½†æ— æ³•è·å–è¿›ç¨‹ä¿¡æ¯

```
âš ï¸  ç«¯å£ 3849 å·²è¢«å ç”¨
   å ç”¨è¿›ç¨‹: Unknown (PID: Unknown)
```

**åŸå› **ï¼šå¯èƒ½ç¼ºå°‘å¿…è¦çš„æƒé™æˆ–ç³»ç»Ÿå‘½ä»¤ä¸å¯ç”¨

**è§£å†³**ï¼š
- Windows: ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ
- Linux/Mac: ä½¿ç”¨ `sudo` æˆ–ç¡®ä¿æœ‰è¶³å¤Ÿæƒé™

### æ— æ³•ç»“æŸè¿›ç¨‹

```
âœ— æ— æ³•ç»“æŸè¿›ç¨‹
```

**åŸå› **ï¼š
- æƒé™ä¸è¶³
- è¿›ç¨‹å—ä¿æŠ¤
- è¿›ç¨‹å·²ç»ç»“æŸä½†ç«¯å£æœªé‡Šæ”¾

**è§£å†³**ï¼š
- ä½¿ç”¨ç®¡ç†å‘˜/rootæƒé™
- æ‰‹åŠ¨ç»“æŸè¿›ç¨‹
- ç­‰å¾…ä¸€æ®µæ—¶é—´åé‡è¯•

### è¿›ç¨‹ç»“æŸä½†ç«¯å£ä»è¢«å ç”¨

```
âœ— ç«¯å£ 3849 ä»è¢«å ç”¨
```

**åŸå› **ï¼šç³»ç»Ÿéœ€è¦æ—¶é—´é‡Šæ”¾ç«¯å£

**è§£å†³**ï¼š
- ç­‰å¾…å‡ ç§’åé‡è¯•
- æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–è¿›ç¨‹å ç”¨
- é‡å¯ç½‘ç»œæœåŠ¡

## å®‰å…¨è€ƒè™‘

### 1. æƒé™æ§åˆ¶

- **ä¸è¦éšæ„ä½¿ç”¨ `--auto-kill-port`**ï¼Œç‰¹åˆ«æ˜¯åœ¨å…±äº«æœåŠ¡å™¨ä¸Š
- ç¡®ä¿åªç»“æŸè‡ªå·±æœ‰æƒé™ç®¡ç†çš„è¿›ç¨‹
- åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è°¨æ…ä½¿ç”¨è‡ªåŠ¨ç»“æŸåŠŸèƒ½

### 2. è¿›ç¨‹éªŒè¯

åœ¨è‡ªåŠ¨åŒ–è„šæœ¬ä¸­ï¼Œå»ºè®®å…ˆæ£€æŸ¥è¿›ç¨‹ä¿¡æ¯ï¼š

```bash
# æ£€æŸ¥æ˜¯å¦æ˜¯è‡ªå·±çš„è¿›ç¨‹
python utils/mcp_bridge.py
# æ‰‹åŠ¨ç¡®è®¤åå†ä½¿ç”¨ --auto-kill-port
```

### 3. æ—¥å¿—è®°å½•

æ‰€æœ‰ç«¯å£æ“ä½œéƒ½ä¼šè¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œå»ºè®®ï¼š

```bash
# è®°å½•æ—¥å¿—
python utils/mcp_bridge.py --auto-kill-port 2>&1 | tee mcp-server.log
```

## æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•

1. **å¼€å‘ç¯å¢ƒ**ï¼šä½¿ç”¨äº¤äº’å¼æ¨¡å¼ï¼Œæ‰‹åŠ¨æ§åˆ¶
2. **æµ‹è¯•ç¯å¢ƒ**ï¼šä½¿ç”¨ `--auto-kill-port` å¿«é€Ÿè¿­ä»£
3. **ç”Ÿäº§ç¯å¢ƒ**ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡ + é…ç½®ç®¡ç†
4. **ç›‘æ§ç«¯å£**ï¼šå®šæœŸæ£€æŸ¥ç«¯å£å ç”¨æƒ…å†µ
5. **è®°å½•æ—¥å¿—**ï¼šä¿å­˜å¯åŠ¨æ—¥å¿—ç”¨äºæ’æŸ¥é—®é¢˜

### âŒ ä¸æ¨èåšæ³•

1. åœ¨ä¸äº†è§£å ç”¨è¿›ç¨‹çš„æƒ…å†µä¸‹ç›²ç›®ä½¿ç”¨ `--auto-kill-port`
2. åœ¨å…±äº«æœåŠ¡å™¨ä¸Šä½¿ç”¨è‡ªåŠ¨ç»“æŸåŠŸèƒ½
3. å¿½ç•¥ç«¯å£å ç”¨è­¦å‘Šï¼Œå¼ºåˆ¶å¯åŠ¨
4. ä¸è®°å½•æ—¥å¿—å’Œè¿›ç¨‹ä¿¡æ¯

## æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šæ€»æ˜¯æç¤ºç«¯å£è¢«å ç”¨

**æ£€æŸ¥æ­¥éª¤**ï¼š

1. æŸ¥çœ‹æ˜¯å¦æœ‰æ—§è¿›ç¨‹åœ¨è¿è¡Œ
   ```bash
   # Windows
   netstat -ano | findstr :3849
   
   # Linux/Mac
   lsof -i :3849
   ```

2. æ‰‹åŠ¨ç»“æŸè¿›ç¨‹
   ```bash
   # Windows
   taskkill /F /PID <PID>
   
   # Linux/Mac
   kill -9 <PID>
   ```

3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

4. å°è¯•ä½¿ç”¨å…¶ä»–ç«¯å£

### é—®é¢˜ï¼šè‡ªåŠ¨ç»“æŸåŠŸèƒ½ä¸å·¥ä½œ

**æ£€æŸ¥æ­¥éª¤**ï¼š

1. ç¡®è®¤æœ‰è¶³å¤Ÿæƒé™
2. æ£€æŸ¥ç³»ç»Ÿå‘½ä»¤æ˜¯å¦å¯ç”¨ï¼ˆnetstat/lsofï¼‰
3. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
4. å°è¯•æ‰‹åŠ¨ç»“æŸè¿›ç¨‹

## ç¤ºä¾‹è„šæœ¬

### å¯åŠ¨è„šæœ¬ï¼ˆWindowsï¼‰

```batch
@echo off
echo Starting MCP Bridge Server...

REM æ£€æŸ¥æ˜¯å¦å·²è¿è¡Œ
netstat -ano | findstr :3849 > nul
if %errorlevel%==0 (
    echo Port 3849 is in use, killing process...
    for /f "tokens=5" %%a in ('netstat -ano ^| findstr :3849') do (
        taskkill /F /PID %%a
    )
    timeout /t 2 /nobreak > nul
)

REM å¯åŠ¨æœåŠ¡
python utils/mcp_bridge.py --auto-kill-port

pause
```

### å¯åŠ¨è„šæœ¬ï¼ˆLinux/Macï¼‰

```bash
#!/bin/bash

echo "Starting MCP Bridge Server..."

# æ£€æŸ¥æ˜¯å¦å·²è¿è¡Œ
PID=$(lsof -ti :3849)
if [ ! -z "$PID" ]; then
    echo "Port 3849 is in use by PID $PID, killing process..."
    kill -9 $PID
    sleep 2
fi

# å¯åŠ¨æœåŠ¡
python3 utils/mcp_bridge.py --auto-kill-port
```

### å®ˆæŠ¤è¿›ç¨‹è„šæœ¬

```bash
#!/bin/bash

while true; do
    echo "Starting MCP Bridge Server at $(date)"
    python3 utils/mcp_bridge.py --auto-kill-port
    
    echo "Server stopped at $(date), restarting in 5 seconds..."
    sleep 5
done
```

## æ€»ç»“

ç«¯å£ç®¡ç†åŠŸèƒ½æä¾›äº†çµæ´»ä¸”å®‰å…¨çš„æ–¹å¼æ¥å¤„ç†ç«¯å£å ç”¨é—®é¢˜ï¼š

- ğŸ” **è‡ªåŠ¨æ£€æµ‹** - å¯åŠ¨å‰è‡ªåŠ¨æ£€æŸ¥ç«¯å£çŠ¶æ€
- ğŸ¤ **äº¤äº’å¼** - æä¾›å‹å¥½çš„äº¤äº’å¼é€‰é¡¹
- ğŸ¤– **è‡ªåŠ¨åŒ–** - æ”¯æŒå®Œå…¨è‡ªåŠ¨åŒ–çš„éƒ¨ç½²
- ğŸ”’ **å®‰å…¨** - æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯ï¼Œé¿å…è¯¯æ“ä½œ
- ğŸ“Š **ä¿¡æ¯ä¸°å¯Œ** - æ˜¾ç¤ºå ç”¨è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯

é€‰æ‹©åˆé€‚çš„å¯åŠ¨æ–¹å¼ï¼Œè®©æ‚¨çš„éƒ¨ç½²æ›´åŠ é¡ºç•…ï¼
